name: Sync Turso Database

on:
  push:
    branches: [ main ]
    paths:
      - 'db/config.ts'  # Solo ejecuta cuando cambia el esquema
      - '.github/workflows/db-sync.yml'

jobs:
  sync-db:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - run: npm ci
      
      - name: Push schema to Turso
        run: npm run astro db push -- --remote
        env:
          ASTRO_DB_REMOTE_URL: ${{ secrets.TURSO_DATABASE_URL }}
          ASTRO_DB_APP_TOKEN: ${{ secrets.TURSO_AUTH_TOKEN }}
